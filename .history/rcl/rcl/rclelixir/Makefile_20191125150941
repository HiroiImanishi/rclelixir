CC		:= gcc
TARGET	:= init3.so
DEST	:= ./lib
ROOTDIR := ../../..
RCLDIR	:= ..
RMWDIR	:= $(ROOTDIR)/rmw/rmw
RCUTILSDIR := $(ROOTDIR)/rcutils
ROSIDLDIR  := $(ROOTDIR)/rosidl
SRCDIR	:= ./nif_src
CFLAGS  := -O3 -fpic -shared
LINK := -lstdc++
INCLUDE	:= -I. -I /usr/lib/erlang/erts-10.5.2/include -I $(RCLDIR)/include -I $(RCUTILSDIR)/include -I $(RMWDIR)/include \
-I $(ROSIDLDIR)/rosidl_generator_c/include -I $(ROSIDLDIR)/rosidl_typesupport_interface/include -I $(ROOTDIR)/rmw_fastrtps/rmw_fastrtps_cpp/include -I $(ROOTDIR)

all:$(TARGET)
RCLSRCS	:= $(wildcard $(RCLDIR)/src/rcl/*.c) 

$(TARGET): 
	$(CC) $(CFLAGS) $(INCLUDE) -o $(DEST)/$(TARGET) $(SRCDIR)/init_nif.c \
	$(RCLDIR)/src/rcl/init_options.c $(ROOTDIR)/rcutils/src/error_handling.c $(RCLDIR)/src/rcl/context.c $(RCLDIR)/src/rcl/arguments.c $(ROOTDIR)/rcutils/src/logging.c $(ROOTDIR)/rcutils/src/time.c \
	$(RCUTILSDIR)/src/string_map.c $(ROOTDIR)/rcutils/src/allocator.c $(RCLDIR)/src/rcl/lexer_lookahead.c $(ROOTDIR)/rcutils/src/char_array.c $(ROOTDIR)/rcutils/src/strdup.c $(ROOTDIR)/rcutils/src/time_unix.c \
	$(ROOTDIR)/rmw_fastrtps/rmw_fastrtps_cpp/src/rmw_init.cpp $(ROOTDIR)/rmw_fastrtps/rmw_fastrtps_cpp/src/identifier.cpp $(ROOTDIR)/rcl/rcl/src/rcl/remap.c $(ROOTDIR)/rcutils/src/get_env.c \
	$(RCLDIR)/src/rcl/expand_topic_name.c $(RMWDIR)/src/validate_namespace.c $(RMWDIR)/src/init.c $(RMWDIR)/src/allocators.c \
	$(RCUTILSDIR)/src/hash_map.c $(RCUTILSDIR)/src/array_list.c $(RCLSRCS)\
	$(LINK)

